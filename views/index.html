<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="{{ url("/") }}">
    <title>Futuristic Calendar</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url("style.css") }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-secondary custom-navbar">
        <div class="container-fluid">
            <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url("/") }}">Calendar</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url("events") }}">All Events</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container mt-5 mb-4 p-4 main-calendar-container">
        <header class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom border-primary header-custom">
            <h1 class="title"> <i>Meeting Reminder</i></h1>
            <i><div class="date-display" id="current-month-year"></div></i>
        </header>
        <div class="row g-3">
            <div class="col-lg-8">
                <div class="d-flex justify-content-center gap-3 mb-3 calendar-nav-custom">
                    <button id="prev-month" class="btn btn-outline-light nav-button-custom"><i class="fas fa-chevron-left"></i></button>
                    <button id="next-month" class="btn btn-outline-light nav-button-custom"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid-custom p-3">
                    <div class="day-name">SUN</div>
                    <div class="day-name">MON</div>
                    <div class="day-name">TUE</div>
                    <div class="day-name">WED</div>
                    <div class="day-name">THU</div>
                    <div class="day-name">FRI</div>
                    <div class="day-name">SAT</div>
                    <!-- Calendar days will be inserted here by JavaScript -->
                </div>
            </div>
            <div class="col-lg-4">
                <div class="event-sidebar-custom p-4">
                    <h2>Upcoming Events</h2>
                    <ul id="event-list" class="list-group list-group-flush">
                        <li class="list-group-item event-list-item">
                            <span class="event-date">2025-10-25</span> Project Alpha Review
                        </li>
                        <li class="list-group-item event-list-item">
                            <span class="event-date">2025-10-28</span> Team Sync
                        </li>
                        <li class="list-group-item event-list-item">
                            <span class="event-date">2025-11-01</span> System Upgrade
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{{ url("script.js") }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const calendarGrid = document.querySelector('.calendar-grid-custom');
            const currentMonthYearDisplay = document.getElementById('current-month-year');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const eventList = document.getElementById('event-list');

            let currentDate = new Date();

            

            var events = {{ events }};
            
            
            events = events.map(event => {

                const date = new Date(event.start_timestamp);

                event.date = `${date.getFullYear()}-${10}-${date.getDay() < 10 ? `0${date.getDay()}` : date.getDay()}`;

                return event;
            })


            console.log("EVENTS", events);


            
            
            // [
            //     { date: '2025-10-25', title: 'Project Alpha Review' },
            //     { date: '2025-10-28', title: 'Team Sync' },
            //     { date: '2025-11-01', title: 'System Upgrade' },
            //     { date: '2025-11-07', title: 'Client Demo Prep' },
            //     { date: '2025-11-15', title: 'Cyber Security Workshop' },
            //     { date: '2025-12-05', title: 'Annual Tech Summit' },
            //     { date: '2025-12-20', title: 'Holiday Party Planning' }
            // ];

            function renderCalendar() {
                // Clear previous days, but preserve day names (first 7 elements)
                while (calendarGrid.children.length > 7) {
                    calendarGrid.removeChild(calendarGrid.lastChild);
                }

                const year = currentDate.getFullYear();
                const month = currentDate.getMonth(); // 0-indexed

                currentMonthYearDisplay.textContent = new Date(year, month).toLocaleString('en-US', { month: 'long', year: 'numeric' });

                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0);
                const numDaysInMonth = lastDayOfMonth.getDate();

                // Calculate the day of the week for the first day of the month (0 for Sunday, 1 for Monday, etc.)
                const startDayIndex = firstDayOfMonth.getDay(); // Number of leading blank cells/previous month cells

                // Previous month's days
                const prevMonthLastDay = new Date(year, month, 0); // Last day of previous month
                const numDaysInPrevMonth = prevMonthLastDay.getDate();

                for (let i = startDayIndex - 1; i >= 0; i--) {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('calendar-day', 'other-month');
                    dayDiv.textContent = numDaysInPrevMonth - i;
                    calendarGrid.appendChild(dayDiv);
                }

                // Current month's days
                for (let i = 1; i <= numDaysInMonth; i++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('calendar-day', 'current-month');
                    dayDiv.textContent = i;

                    const fullDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    if (isToday(year, month, i)) {
                        dayDiv.classList.add('today');
                    }

                    if (hasEvent(fullDate)) {
                        const eventIndicator = document.createElement('div');
                        eventIndicator.classList.add('event-indicator');
                        dayDiv.appendChild(eventIndicator);
                    }

                    calendarGrid.appendChild(dayDiv);
                }

                // Next month's days (fill to a fixed 6x7 grid = 42 cells total)
                const totalDaysRenderedSoFar = startDayIndex + numDaysInMonth;
                const totalCellsInGrid = 42; // For a consistent 6-week calendar display

                const remainingCellsToFill = totalCellsInGrid - totalDaysRenderedSoFar;

                for (let i = 1; i <= remainingCellsToFill; i++) {
                    const dayDiv = document.createElement('div');
                    dayDiv.classList.add('calendar-day', 'other-month');
                    dayDiv.textContent = i;
                    calendarGrid.appendChild(dayDiv);
                }

                renderEventList(year, month);
            }

            function isToday(year, month, day) {
                const today = new Date();
                return today.getFullYear() === year &&
                    today.getMonth() === month &&
                    today.getDate() === day;
            }

            function hasEvent(dateString) {
                return events.some(event => event.date === dateString);
            }

            function renderEventList(year, month) {
                eventList.innerHTML = '';
                const currentMonthEvents = events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate.getFullYear() === year && eventDate.getMonth() === month;
                }).sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort by date

                if (currentMonthEvents.length === 0) {
                    const li = document.createElement('li');
                    li.classList.add('list-group-item', 'event-list-item'); // Add classes for styling
                    li.textContent = 'No events this month.';
                    eventList.appendChild(li);
                } else {
                    currentMonthEvents.forEach(event => {
                        const li = document.createElement('li');
                        li.classList.add('list-group-item', 'event-list-item'); // Add classes for styling
                        const eventDateSpan = document.createElement('span');
                        eventDateSpan.classList.add('event-date');
                        eventDateSpan.textContent = event.date;
                        li.appendChild(eventDateSpan);
                        li.appendChild(document.createTextNode(` ${event.title}`));
                        eventList.appendChild(li);

                        // Add click event listener to redirect to event.html
                        li.addEventListener('click', () => {
                            window.location.href = 'event.html';
                        });
                    });
                }
            }

            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            renderCalendar(); // Initial render
        });
    </script>


</body>
</html>